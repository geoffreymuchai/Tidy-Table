/*
 *  Tidy Table
 *  Generate a sortable HTML table from JSON
 *
 *  Copyright 2012-2013, Marc S. Brooks (http://mbrooks.info)
 *  Licensed under the MIT license:
 *  http://www.opensource.org/licenses/mit-license.php
 *
 *  Dependencies:
 *    jquery.js
 */(function(a){function c(b,c,e,h){var i=a("<table></table>").addClass("tidy_table"),j=a("<thead></thead>"),k=a("<tbody></tbody>"),l=a("<tr></tr>"),m=c.columnTitles;for(var n=0;n<m.length;n++){var o=m[n],p=a("<th></th>").append(o).attr("title",o);l.append(p);var q;h=="desc"||!h?(q="sort_desc",p.order="asc"):(q="sort_asc",p.order="desc"),e==n&&p.addClass(q),p.bind("click",{col_number:n,sort_order:p.order},function(a){g(b,c,a.data.col_number,a.data.sort_order)})}j.append(l);var r=c.columnValues;for(var s=0;s<r.length;s++){var l=a("<tr></tr>");for(var t=0;t<r[s].length;t++){var u=r[s][t];if(b.options&&b.options.editable){var v=a("<input />",{name:m[t].toLowerCase(),type:"text",value:u}),p=a("<td></td>").append(v);l.append(p)}else{var p=a("<td></td>").append(u).attr("title",u);l.append(p)}c.postProcess&&typeof c.postProcess.column=="function"&&c.postProcess.column(p)}k.append(l)}i.append(j),i.append(k);if(b.options&&b.options.enableCheckbox){var w=i.find("tr");w.each(function(b){l=a(this);var c=a("<input></input>").attr("type","checkbox"),d;b==0?(d=a("<th></th>"),c.click(function(){f(w)})):(d=a("<td></td>"),c.bind("click",{box_number:b},function(a){f(w,a.data.box_number)})),d.append(c),l.prepend(d)})}c.postProcess&&typeof c.postProcess.table=="function"&&c.postProcess.table(i);var x=b.container,y=x.children("table.tidy_table");return y[0]?y.replaceWith(i):(b.options&&b.options.enableMenu&&x.append(d(x,c,"menu1")),x.append(i),b.options&&b.options.enableMenu&&x.append(d(x,c,"menu2"))),i}function d(b,c,d){var f=c.menuOptions,g=a("<select></select>").addClass("menu_options "+d).change(function(){var c=a(this),d=f[c.val()][1].callback;typeof d=="function"&&d(e(b)),c.val(0)});return a.each(f,function(b){var c=a("<option>"+f[b][0]+"</option>").attr("value",b);g.append(c)}),c.postProcess&&typeof c.postProcess.menu=="function"&&c.postProcess.menu(g),g}function e(a){var b=a.find("tbody > tr"),c=[];for(var d=0;d<b.length;d++){var e=b[d].childNodes;if(e[0].firstChild.checked){var f=[];for(var g=1;g<e.length;g++)f[g-1]=e[g].textContent;c.push(f)}}return c}function f(b,c){var d=null;b.each(function(b){var e=a(this),f=e.children().find("input[type=checkbox]");if(c==null){if(b==0){d=f.is(":checked")?!0:!1;return}d?(e.removeClass("check_off").addClass("check_on"),f.attr("checked",!0)):(e.removeClass("check_on").addClass("check_off"),f.attr("checked",!1))}else f.is(":checked")?(e.removeClass("check_off").addClass("check_on"),f.attr("checked",!0)):(e.removeClass("check_on").addClass("check_off"),f.attr("checked",!1))})}function g(a,b,d,e){var f=e=="desc"?-1:1;b.columnValues.sort(function(a,b){var c=String(a[d]).replace(/$|%|#/g,""),e=String(b[d]).replace(/$|%|#/g,"");return isNaN(c)?[f*h(c,e)]>[f*h(e,c)]?-1:1:[f*i(c,e)]}),c(a,b,d,e)}function h(a,b){return a>b?1:a<b?-1:0}function i(a,b){return b-a}var b={init:function(b,d){var e={enableCheckbox:!1,enableMenu:!1,editable:!1};return arguments.length>1?a.extend(e,b):d=b,this.each(function(){var b=a(this),f=b.data();return a.isEmptyObject(f)&&b.data({container:b,options:e}),c(f,d)})},destroy:function(){return this.each(function(){a(this).removeData()})}};a.fn.TidyTable=function(c){if(b[c])return b[c].apply(this,Array.prototype.slice.call(arguments,1));if(typeof c=="object"||!c)return b.init.apply(this,arguments);a.error("Method "+c+" does not exist on jQuery.TidyTable")}})(jQuery);